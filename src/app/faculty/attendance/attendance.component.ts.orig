import { Component, OnInit,ViewChild } from '@angular/core';
<<<<<<< HEAD
import { PiechartComponent } from 'src/app/miscellaneous/piechart/piechart.component';
=======
>>>>>>> Sonal
import {NgForm, Validators,FormControl,FormGroup} from "@angular/forms";
import {LeaveRequest} from "src/app/Model/leaveRequest.model";
import {LeaveService} from 'src/app/API_Service/leave.service';
import { IDropdownSettings } from 'ng-multiselect-dropdown';
<<<<<<< HEAD
=======
import { ToastrManager } from 'ng6-toastr-notifications';
>>>>>>> Sonal



@Component({
  selector: 'app-attendance',
  templateUrl: './attendance.component.html',
  styleUrls: ['./attendance.component.scss']
})

export class AttendanceComponent implements OnInit {

  
  @ViewChild("f") addLeave:NgForm;
  @ViewChild("rejoin") ReJoin:NgForm;
  @ViewChild("f") cancelLeave:NgForm;
<<<<<<< HEAD

  userName:String
  leave_type:any[]=[];
  request:LeaveRequest;
  approved=false;
  bar=[];
  leaveRequests:any[]=[];
  showconfirmationCancel:boolean=false;
  showconfirmationRejoin: boolean=false;
  showMsg: boolean = false;
  showDateError=false;
  showNullError=false;
  showPastDateError=false;
  showCreditError=false;

  constructor(public chart: PiechartComponent,private leaveService:LeaveService) { }
=======
  // @ViewChild("cancelAfterApprove") cancelAfterApproved:NgForm;

  userName:string
  leave_type:any[]=[];
  request:LeaveRequest;
  myLeaveRequests:any[]=[];
  myLeaveAccount:any[];
  leaveId:number;

  

  showMsg: boolean = false;
  showDateError=false;
  showNullError=false;


  constructor(private leaveService:LeaveService,public toastr: ToastrManager) { }
>>>>>>> Sonal

  ngOnInit() {

      this.userName = sessionStorage.getItem('authenticaterUser');
<<<<<<< HEAD
      console.log(this.userName)

      this.bar = this.chart.getPieChart('pieChart');
=======
      this.leaveId=0;
      
      this.leaveService.getMyLeaveRequests(this.userName).subscribe(data=>{
        console.log(data);
        this.myLeaveRequests=data;
        
      });
      
>>>>>>> Sonal
      this.leaveService.getLeave().subscribe(data=>{
        console.log(data);
        this.leave_type=data;
        
      });
      console.log(this.leave_type);

<<<<<<< HEAD
      this.leaveService.getRequests().subscribe(data=>{
        console.log(data);
        this.leaveRequests=data;
        
      });
      console.log(this.leaveRequests);
    }

  delay(ms: number) {
    return new Promise( resolve => setTimeout(resolve, ms) );
    }
=======
      this.leaveService.getMyLeaveAccount().subscribe(data=>{
        // console.log(data.annual);
        this.myLeaveAccount=data;
        
      });

      
  }

  getLeaveRequest(id:number){
      this.leaveId = id;
  }

  getLeavesByStatus(status:string){
    this.leaveService.getRequestsByStatus(status).subscribe(data=>{
      this.myLeaveRequests=data;
    });

  }

  delay(ms: number) {
    return new Promise( resolve => setTimeout(resolve, ms) );
  }
>>>>>>> Sonal

  onSubmit(){
    var curDate=new Date().toLocaleDateString();
    let fromDate: Date = new Date(this.addLeave.value.from); 
    var fDate= fromDate.toLocaleDateString();
    let toDate: Date = new Date(this.addLeave.value.to); 
    var tDate= toDate.toLocaleDateString();
    
<<<<<<< HEAD
  
    console.log(fDate);
    console.log(this.addLeave.value.to)
    console.log(this.addLeave.value.from)
    console.log(this.addLeave.value.leaveType)
    console.log(this.addLeave.value.reason)
    
=======
>>>>>>> Sonal
    if(this.addLeave.value.leaveType==null){
      this.showNullError=true;
      this.delay(3000).then(any=>{
        this.showNullError= false;   
   })
    }
    else if(this.addLeave.value.duration==""){
      this.showNullError=true;
      this.delay(3000).then(any=>{
        this.showNullError= false;   
   })
    }
    else if(this.addLeave.value.from==""){
      this.showNullError=true;
      this.delay(3000).then(any=>{
        this.showNullError= false;   
   })
    }
    else if(this.addLeave.value.to==""){
      this.showNullError=true;
      this.delay(3000).then(any=>{
        this.showNullError= false;   
   })
    }
    else if(this.addLeave.value.reason==null){
      this.showNullError=true;
      this.delay(3000).then(any=>{
        this.showNullError= false;   
   })
    }

    else if(this.addLeave.value.from>this.addLeave.value.to){
      this.showDateError=true;
      this.delay(3000).then(any=>{
        this.showDateError= false;
        
   })
   this.addLeave.reset();

    }
<<<<<<< HEAD

=======
>>>>>>> Sonal
    else{
    this.request=new LeaveRequest();
   
    this.request.typeOfLeave=this.addLeave.value.leaveType;
    this.request.fromDuration=this.addLeave.value.fromDuration;
    this.request.toDuration=this.addLeave.value.toDuration;
    this.request.fromDate=this.addLeave.value.from;
    this.request.considerHolidays=this.addLeave.value.considerHolidays;
    this.request.toDate=this.addLeave.value.to;
    this.request.prefix=this.addLeave.value.from;
    this.request.suffix=this.addLeave.value.to;
    this.request.details=this.addLeave.value.reason;
    this.request.status="pending";
<<<<<<< HEAD
    this.leaveService.addRequest(this.request);
    
    this.showMsg= true;
    this.addLeave.reset();
    this.delay(3000).then(any=>{
      this.showMsg= false;})
    console.log(this.request)
    }
    
   }
   getRequests(){
     return this.leaveRequests;
   }
   onReset(){
    this.addLeave.reset();
   }
   
   Rejoin(req: LeaveRequest){
     req.toDate=this.ReJoin.value.to 
     this.showconfirmationRejoin= true;
   }
   
   Cancel(req:LeaveRequest){
  
    this.request.status="canceled";
     this.leaveService.deleteRequest(req);
     this.showconfirmationCancel= true;
=======
    console.log(this.request)
    this.leaveService.addRequest(this.request);
    
    this.toastr.successToastr('Leaves Request Sent', 'Success!');
    this.ngOnInit();
    }
  }
  
  onReset(){
    this.addLeave.reset();
  }

  // cancelAfterApproval(){
  //   console.log("sonal")
  //   this.leaveService.cancelRequest(this.leaveId);
  //   this.toastr.successToastr('Leaves Cancelled', 'Success!');
  // }

  Rejoin(){
    var data={leaveId:this.leaveId,rejoinDate:this.ReJoin.value.rejoinTo,toDuration:this.ReJoin.value.rejointoDuration}
    console.log(data);
    this.leaveService.rejoin(data);
    this.toastr.successToastr('Rejoined after Leave', 'Success!');
    
   }
   
  cancel(){
    var data={leaveId:this.leaveId,status:"cancelled"}
    this.leaveService.UpdateStatus(data)
    this.toastr.successToastr('Leaves Cancelled', 'Success!');
>>>>>>> Sonal
  }
}
